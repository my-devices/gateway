<!DOCTYPE HTML>
<%@ page class="DevicePage" namespace="MyDevices::Gateway" contentType="text/html;charset=utf-8" compressed="true" context="DeviceManager::Ptr" precondition="U::authenticate(request, response)" %>

<%@ header include="DeviceManager.h" %>
<%@ impl include="DevicePageController.h" %>
<%@ include file="../html/template.inc" %>

<%%
DevicePageController ctrl(context(), request, form);
if (response.sent()) return;

if (ctrl.deviceConfig())
{
	pageTemplate.set("title", "Gateway > " + ctrl.deviceConfig()->getString("webtunnel.deviceName"));
}
else
{
	pageTemplate.set("title", "Gateway > Unknown Device");
}
%>

<%@ include file="../html/header.inc" %>

<script language="JavaScript">
function cancelUpdateDevice(id)
{
  document.actionForm.action.value = "cancel";
  document.actionForm.submit();
}
</script>

<% if (!ctrl.message().empty()) { %>
  <div class="error">
    <%= U::htmlize(ctrl.message()) %>
  </div>
<% } %>

<% if (ctrl.deviceConfig()) { %>
  <div class="groupbox">
    <h2>Device Properties</h2>

    <form name="actionForm" method="post" action="/">
      <input type="hidden" name="action" value="update">
      <input type="hidden" name="target" value="<%= ctrl.deviceConfig()->getString("webtunnel.deviceId") %>">
      <table class="list">
        <tbody>
          <tr class="intermediateHeader">
            <th colspan="2">
              Basic Properties
            </th>
          </tr>
          <tr class="even">
            <td class="basicProperty">Name</td>
            <td>
              <input type="text"
                     name="deviceName"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.deviceName")) %>"
                     size="64"
                     maxLength="64"
                     class="form-control">
            </td>
          </tr>
          <tr class="odd">
            <td class="basicProperty">ID</td>
            <td><%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.deviceId")) %></td>
          </tr>
          <tr class="even">
            <td class="basicProperty">Domain</td>
            <td>
              <input type="text"
                     name="domain"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.domain", "")) %>"
                     size="64"
                     maxLength="64"
                     class="form-control"
                     >
            </td>
          </tr>
          <tr class="odd">
            <td>Device Password</td>
            <td>
              <input type="password"
                     name="password"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.password", "")) %>"
                     size="32"
                     maxLength="32"
                     class="form-control">
              (optional)
            </td>
          </tr>
          <tr class="even">
            <td>Status</td>
            <td><%= ctrl.deviceStatus() %></td>
          </tr>
          <tr class="intermediateHeader">
            <th colspan="2">
              Device Address and Ports
            </th>
          </tr>
          <tr class="even">
            <td class="basicProperty">Device IP Address or Domain Name</td>
            <td>
              <input type="text"
                     name="host"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.host", "")) %>"
                     size="64"
                     maxLength="64"
                     class="form-control">
            </td>
          </tr>
          <tr class="odd">
            <td class="basicProperty">Forwarded TCP Ports</td>
            <td>
              <input type="text"
                     name="ports"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.ports", "")) %>"
                     size="40"
                     maxLength="40"
                     class="form-control">
              (comma-separated)
            </td>
          </tr>
          <tr class="even">
            <td class="basicProperty">Device HTTP Server Port</td>
            <td>
              <input type="number"
                     name="httpPort"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.httpPort", "")) %>"
                     size="5"
                     maxLength="5"
                     min="0"
                     max="65535"
                     class="form-control">
            </td>
          </tr>
          <tr class="odd">
            <td>Device SSH Server Port</td>
            <td>
              <input type="number"
                     name="sshPort"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.sshPort", "")) %>"
                     size="5"
                     maxLength="5"
                     min="1"
                     max="65535"
                     class="form-control">
              (optional)
            </td>
          </tr>
          <tr class="even">
            <td>Device VNC Server Port</td>
            <td>
              <input type="number"
                     name="vncPort"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.vncPort", "")) %>"
                     size="5"
                     maxLength="5"
                     min="1"
                     max="65535"
                     class="form-control">
              (optional)
            </td>
          </tr>
          <tr class="odd">
            <td>Device RDP Server Port</td>
            <td>
              <input type="number"
                     name="rdpPort"
                     value="<%= U::htmlize(ctrl.deviceConfig()->getString("webtunnel.rdpPort", "")) %>"
                     size="5"
                     maxLength="5"
                     min="1"
                     max="65535"
                     class="form-control">
              (optional)
            </td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: right">
              <a href="#" onclick="cancelUpdateDevice()">Cancel</a>
              &nbsp;
              <input type="submit" value="Save" class="form-control">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </form>
<% } %> <%-- if --%>

<%@ include file="../html/footer.inc" %>
